{
  "decision": "D9",
  "title": "Path Variables & File Structure",
  "current_question": "COMPLETE",
  "questions_completed": 16,
  "total_questions": 16,
  "status": "complete",
  "created": "2025-12-10",
  "last_updated": "2025-12-11",
  "decisions": [
    {
      "question": "Q1",
      "topic": "System-level variable resolution",
      "decision": "Option C: Hybrid Resolution",
      "description": "{home} from env var ($HOME/Path.home()), {project-root} from Claude Code working directory context",
      "confidence": "9/10",
      "specialist_consensus": "2/3 (Coder 9/10, Tester 8/10 favor C; Architect 9/10 favors D)",
      "binding_constraint": "D2-Q20: Hybrid Resolution - hooks for critical System/Path vars",
      "loc_estimate": "115 LOC (~50 net new)",
      "tco_3year": "$3,970",
      "decided_at": "2025-12-11T12:00:00Z",
      "session": 72
    },
    {
      "question": "Q2",
      "topic": "Framework-level variable paths",
      "decision": "Option C: Variable-Chained",
      "description": "Framework variables reference System variables (e.g., {bmad-framework-root} = {home}/.claude/bmad), resolved via cascade",
      "confidence": "9/10",
      "specialist_consensus": "2/3 (Architect 9/10, Coder 8/10 favor C; Tester 8/10 favors D)",
      "binding_constraint": "D4-Q16: 4-level cascade adopted from Personal BMAD",
      "loc_estimate": "395 LOC (~240 net new)",
      "tco_3year": "$12,000",
      "decided_at": "2025-12-11T12:00:00Z",
      "session": 72
    },
    {
      "question": "Q3",
      "topic": "Legacy variable aliases handling",
      "decision": "Option A: Direct Aliasing",
      "description": "Legacy variables (bmad_path, output_folder, lsposed_reference_path) are simple aliases to modern equivalents, resolved transparently at Level 4 of the 4-level cascade",
      "confidence": "8.5/10",
      "specialist_consensus": "3/4 (Architect 8/10, Coder 9/10, Tester 8/10 favor A; Research 9/10 favors B)",
      "binding_constraint": "D4-Q16: 4-level cascade - Level 4 IS legacy variables",
      "loc_estimate": "70 LOC (~40 net new + 30 tests)",
      "tco_3year": "$5,500",
      "decided_at": "2025-12-11T14:30:00Z",
      "session": 73
    },
    {
      "question": "Q4",
      "topic": "Root structure for global installation",
      "decision": "Option A: Personal BMAD Structure",
      "description": "Use existing ~/.claude/{plugins,bmad,workflows,commands}/ structure - ONLY option that maintains Claude Code integration",
      "confidence": "9.5/10",
      "specialist_consensus": "4/4 UNANIMOUS (Architect 10/10, Research 7/10, Coder 9/10, Tester 9/10)",
      "binding_constraint": "D3-Q9/Q17: Project > User > System priority; Claude Code plugin discovery REQUIRES ~/.claude/plugins/cache/",
      "loc_estimate": "35 LOC",
      "tco_3year": "$3,000",
      "decided_at": "2025-12-11T14:30:00Z",
      "session": 73
    },
    {
      "question": "Q5",
      "topic": "Module directory organization",
      "decision": "Option A: Module-first Organization",
      "description": "Organize as {framework-root}/{module}/ with config.yaml, agents/, workflows/, tasks/ per module - PRE-SELECTED by D9-Q4's choice of ~/.claude/bmad/{module}/ structure",
      "confidence": "9/10",
      "specialist_consensus": "3/4 (Architect 9/10, Coder 8/10, Tester 8/10 favor A; Research 7/10 favors B type-first)",
      "binding_constraint": "D9-Q4: Personal BMAD structure chose ~/.claude/bmad/{module}/ which IS module-first",
      "loc_estimate": "100 LOC (module loader + path resolver + registry)",
      "tco_3year": "$4,000",
      "decided_at": "2025-12-11T16:00:00Z",
      "session": 74
    },
    {
      "question": "Q6",
      "topic": "Agent plugin file location",
      "decision": "Option A: Claude Code Plugin Path",
      "description": "Use ~/.claude/plugins/marketplaces/local/plugins/{module}/agents/ for native Claude Code auto-discovery - CURRENT STATE with proven 99.4% performance improvement (15min -> <5sec agent spawn)",
      "confidence": "8.5/10",
      "specialist_consensus": "Split resolved by performance evidence - Coder 9/10 (proven performance), Architect 9/10 (Option E symlink), Research 8/10 (Option B), Tester 8/10 (Option D)",
      "binding_constraint": "D9-Q4: Explicitly chose Personal BMAD structure; D3-Q16: O(1) stem matching via plugin registry",
      "loc_estimate": "50 LOC (deployment script only - discovery is Claude Code native)",
      "tco_3year": "$3,500",
      "decisive_factor": "99.4% performance improvement ALREADY ACHIEVED with current implementation",
      "decided_at": "2025-12-11T16:00:00Z",
      "session": 74
    },
    {
      "question": "Q7",
      "topic": "Project-local output directory structure",
      "decision": "Option A: Fixed Structure",
      "description": "Predefined subdirectories (epics, stories, analysis, blueprints, research) auto-created at {project-root}/bmad/ - matches BMAD actual implementation and D9-Q4 architectural consistency",
      "confidence": "8.5/10",
      "specialist_consensus": "3/4 (Architect 8/10, Coder 9/10, Tester 9/10 favor A; Research 9/10 favors B workflow-driven)",
      "binding_constraint": "None (D9-Q4 provides architectural signal only, not binding)",
      "loc_estimate": "80 LOC",
      "tco_3year": "$650",
      "reuse_percentage": "90% from claude-mpm ProjectOrganizer",
      "reliability": "94%",
      "decided_at": "2025-12-11T18:00:00Z",
      "session": 75
    },
    {
      "question": "Q8",
      "topic": "Variable resolution order",
      "decision": "Option C: Two-Phase Resolution",
      "description": "Phase 1 (Static): System+Framework vars via hooks at SessionStart. Phase 2 (Dynamic): Project+Runtime vars before/during workflow. Matches D2-Q20 hybrid resolution mandate.",
      "confidence": "9/10",
      "specialist_consensus": "3/4 (Architect 9/10, Coder 9/10, Tester 9/10 favor C; Research 9/10 favors A top-down eager)",
      "binding_constraint": "D2-Q20 PRE-SELECTS: 'hooks for System/Path, LLM for Config/User' IS two-phase",
      "loc_estimate": "100 LOC (on top of D2-Q20 base)",
      "tco_3year": "$700",
      "reuse_percentage": "95% from D2-Q20 implementation",
      "reliability": "91%",
      "decided_at": "2025-12-11T18:00:00Z",
      "session": 75
    },
    {
      "question": "Q9",
      "topic": "Circular/undefined variable handling",
      "decision": "HYBRID A+C: Tier-Aware Handling",
      "description": "CRITICAL/HARD tiers (System/Framework/Config): Fail-fast with error on circular or undefined. SOFT tier (Project/Legacy): Graceful degradation to literal string {var} with warning. Implements phase-aware validation (Phase 1 strict, Phase 2 graceful).",
      "confidence": "8.5/10",
      "specialist_consensus": "4/4 UNANIMOUS (Architect 9/10, Research 8/10, Coder 8/10, Tester 8/10)",
      "binding_constraint": "D9-Q8 (Two-Phase Resolution), D2-Q20 (CRITICAL=fail-fast, HARD=validation, SOFT=fallbacks), D4-Q16 (4-level cascade)",
      "loc_estimate": "~1,190 LOC",
      "tco_3year": "$10,472",
      "reuse_percentage": "15% from config-collector.js",
      "testability": "92% coverage, 61 test cases",
      "industry_validation": "Terraform (fail-fast) + Docker (literal) = hybrid pattern proven",
      "decided_at": "2025-12-11T20:30:00Z",
      "session": 77
    },
    {
      "question": "Q10",
      "topic": "Conditional logic support in variables",
      "decision": "Option A: No Conditionals",
      "description": "Variables remain simple substitutions only. Conditionals handled at workflow logic level. 4-level cascade provides sufficient fallback behavior via priority resolution. D9-Q9 SOFT tier provides literal fallback for undefined.",
      "confidence": "9/10",
      "specialist_consensus": "4/4 UNANIMOUS (Architect 8.75/10, Research 9/10, Coder 9/10, Tester 9/10)",
      "binding_constraint": "D4-Q16 (Static configuration only - PRE-SELECTS A), 4-level cascade provides fallback via priority",
      "loc_estimate": "0 LOC (uses existing cascade)",
      "tco_3year": "$0",
      "reuse_percentage": "100% existing implementation",
      "testability": "95% coverage, 22 test cases",
      "industry_validation": "0/9 major frameworks use conditional variable syntax (npm, pip, cargo, K8s, Terraform, XDG, LangChain, CrewAI, Temporal)",
      "security_note": "Option C rejected due to CVE-documented injection risks (Jinja2, OGNL)",
      "decided_at": "2025-12-11T20:30:00Z",
      "session": 77
    },
    {
      "question": "Q11",
      "topic": "Project output directory auto-creation timing",
      "decision": "Option A: On First Write (Lazy)",
      "description": "Project output directories (epics, stories, analysis, blueprints, research) auto-created via mkdir -p when first file is written. Proven BMAD pattern, no unused directories created.",
      "confidence": "8.5/10",
      "specialist_consensus": "2/4 favor A (Architect 9/10, Coder 92%), 1/4 favors B-aligned (Research 9/10), 1/4 favors C (Tester 8/10)",
      "binding_constraint": "None - D6-Q5 applies to FRAMEWORK dirs only, not project dirs",
      "loc_estimate": "~50-55 LOC",
      "tco_3year": "$135",
      "reuse_percentage": "85% from claude-mpm ProjectOrganizer",
      "test_cases": 38,
      "industry_validation": "BMAD-PERSONAL-ARCHITECTURE.md:190-198 documents lazy mkdir-p pattern",
      "decided_at": "2025-12-11T22:00:00Z",
      "session": 78
    },
    {
      "question": "Q12",
      "topic": "Framework directory auto-creation behavior",
      "decision": "Option B: Installer-Required",
      "description": "Framework directories (~/.claude/bmad/, ~/.claude/plugins/, ~/.claude/workflows/) require explicit installer. D6-Q5 BINDING CONSTRAINT mandates pre-handoff deployment.",
      "confidence": "10/10",
      "specialist_consensus": "3/4 favor B (Architect 10/10, Research 8/10, Coder 95%), 1/4 favors C (Tester 9/10)",
      "binding_constraint": "D6-Q5 PRE-SELECTS: Full deployment pre-handoff REQUIRED - dirs must exist before Claude Code runs",
      "loc_estimate": "~70-100 LOC",
      "tco_3year": "$90",
      "reuse_percentage": "95% from claude-mpm ProjectInitializer",
      "test_cases": 40,
      "industry_validation": "60% installer-required, 40% first-command (0% pure lazy) - npm, Homebrew, pip patterns",
      "decided_at": "2025-12-11T22:00:00Z",
      "session": 78
    },
    {
      "question": "Q13",
      "topic": "Missing intermediate directory handling",
      "decision": "Option A: Full Path Creation (mkdir -p)",
      "description": "Use mkdir -p equivalent (Path.mkdir(parents=True, exist_ok=True)) to create ALL intermediate directories when writing to nested paths. Aligns with D9-Q11 lazy creation model.",
      "confidence": "9.5/10",
      "specialist_consensus": "4/4 UNANIMOUS (Architect 10/10, Research 10/10, Coder 9.5/10, Tester 9/10)",
      "binding_constraint": "D9-Q11 (Lazy Creation) implies automatic intermediate path handling",
      "loc_estimate": "5 LOC",
      "tco_3year": "$150",
      "reuse_percentage": "100% from claude-mpm project_organizer.py:384",
      "test_cases": "28-32",
      "industry_validation": "95% of frameworks (npm, cargo, Rails, Django) use full-path creation",
      "decided_at": "2025-12-11T23:30:00Z",
      "session": 79
    },
    {
      "question": "Q14",
      "topic": "Auto-creation placeholder files",
      "decision": "Option A: No Placeholders",
      "description": "Do NOT add .gitkeep or README.md placeholder files. D9-Q11 lazy creation means directories are NEVER empty at creation time (created when files written), so git tracking is automatic.",
      "confidence": "9.5/10",
      "specialist_consensus": "3/4 favor A (Architect 10/10, Research 9/10, Tester 10/10), Coder 8.5/10 (hybrid for support dirs only)",
      "binding_constraint": "D9-Q11 (Lazy Creation) eliminates empty directory problem entirely",
      "loc_estimate": "0 LOC",
      "tco_3year": "$0",
      "reuse_percentage": "N/A (no code needed)",
      "test_cases": "8-10",
      "industry_validation": "85% of frameworks use no placeholders when files exist",
      "key_insight": "Lazy creation = dirs created WHEN files written = NEVER empty = placeholder files solve non-existent problem",
      "decided_at": "2025-12-11T23:30:00Z",
      "session": 79
    },
    {
      "question": "Q15",
      "topic": "Project-local state reference strategy",
      "decision": "Option A: Reference-Only",
      "description": "Project state stores paths/references to global files, loads content on-demand via Read tool. Never copy global files. References resolved through variable-chained cascade.",
      "confidence": "9/10",
      "specialist_consensus": "3/4 favor A (Architect 9/10, Research 9/10, Coder 9/10), 1/4 favor D (Tester 8/10)",
      "binding_constraint": "D5-Q19 (Reference files NEVER auto-loaded), D4-Q1/Q2 (frontmatter state), D6-Q5 (pre-handoff deployment), D9-Q2 (variable-chained)",
      "loc_estimate": "150 LOC",
      "tco_3year": "$6,000",
      "reuse_percentage": "50% from OutputStyleManager path resolution",
      "industry_validation": "10/10 systems (npm, pip, Docker, K8s, systemd, VS Code, git, Claude Code) use reference-only",
      "key_insight": "Library Card Catalog analogy - store WHERE the book is, not a photocopy. Global files stay global, project state stores references.",
      "decided_at": "2025-12-11T23:59:00Z",
      "session": 80
    },
    {
      "question": "Q16",
      "topic": "Output styles directory location",
      "decision": "Option D: Layered Styles",
      "description": "System styles in {bmad-framework-root}/styles/, User styles in ~/.claude/styles/ (backward compatible), Project overrides in {project-root}/.claude/styles/. Full D3-Q17 priority cascade.",
      "confidence": "8.5/10",
      "specialist_consensus": "3/4 favor D (Architect 9/10, Research 9/10, Tester 9/10), 1/4 favor A (Coder 8/10)",
      "binding_constraint": "D3-Q17 (Project > User > System priority), D9-Q4 (structure acknowledgment needed for styles/)",
      "loc_estimate": "300 LOC",
      "tco_3year": "$8,000",
      "reuse_percentage": "60% from OutputStyleManager",
      "industry_validation": "VS Code, npm, git all use layered cascades for settings/config",
      "key_insight": "Paint Color Swatch analogy - manufacturer provides base colors (System), you add favorites at home (User), and create project-specific swatches (Project).",
      "decided_at": "2025-12-11T23:59:00Z",
      "session": 80
    }
  ],
  "source_documents": [
    "/home/president/bmad-systems/personal bmad/BMAD-PERSONAL-ARCHITECTURE.md",
    "/home/president/bmad-systems/bmad-method-complete-analysis/shards/09-CONFIGURATION.md"
  ],
  "topics": {
    "Q1-Q3": "Variable resolution levels (System/Framework/Legacy)",
    "Q4-Q7": "Complete file structure layout",
    "Q8-Q11": "Variable resolution engine",
    "Q12-Q14": "Auto-creation behavior",
    "Q15-Q16": "Hybrid global/local model details"
  },
  "redundancies_removed": {
    "original_count": 20,
    "removed": 5,
    "removed_questions": [
      "Q1 (4-level cascade adoption) -> D4-Q16",
      "Q9 (path variable resolution mechanism) -> D2-Q20",
      "Q17 (global/local boundary enforcement) -> D2",
      "Q18 (project override capability) -> D3-Q9/Q17",
      "Q15 (framework update propagation) -> D5-Q8"
    ]
  }
}
