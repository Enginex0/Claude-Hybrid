{
  "decision": "D8",
  "title": "Plugin & Agent Format",
  "current_question": 15,
  "questions_completed": 15,
  "total_questions": 15,
  "status": "complete",
  "created": "2025-12-10",
  "last_updated": "2025-12-12",
  "decisions": [
    {
      "question": "Q1",
      "topic": "Plugin manifest required fields",
      "answer": "Option B: Standard (name + version + description)",
      "specialist_consensus": "4/4 UNANIMOUS (Architect 8/10, Research 9/10, Coder 9/10, Tester 8.6/10)",
      "binding_constraints": ["D5-Q9 requires description for manifest-based discovery"],
      "evidence": "93% BMAD plugins use Standard format, Claude Code docs support full schema, Industry standard (npm/VS Code/pip)",
      "implementation": "~50 LOC, ~$3K 2-year TCO",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q2",
      "topic": "Plugin versioning structure",
      "answer": "Option B: Semantic Versioning (X.Y.Z)",
      "specialist_consensus": "4/4 UNANIMOUS (Architect 9/10, Research 10/10, Coder 9/10, Tester 9/10)",
      "binding_constraints": ["Claude Code docs explicitly specify 'Semantic version string'"],
      "evidence": "93% BMAD plugins use semver, 95%+ industry adoption (npm/VS Code/Cargo/pip)",
      "implementation": "~30 LOC using semver package, ~$2.1K 2-year TCO",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q3",
      "topic": "Plugin dependency declarations",
      "answer": "Option A: No dependencies (with documented future path to C)",
      "specialist_consensus": "SPLIT 2/4 C, 1/4 A, 1/4 D -> Resolved to A (Architect 9/10 C, Research 9/10 D, Coder 8/10 C, Tester 9/10 A)",
      "binding_constraints": ["D5-Q9, D8-Q1, D8-Q2 compatible with all options - no constraint forces"],
      "evidence": "0/30 plugins use dependencies (100% self-contained), VS Code extensionDependencies has fundamental bug (#82655), mcp-tools MCP reqs are informal but not blocking",
      "implementation": "0 LOC, $0 TCO, 15 test cases. Future path to Option C (~550 LOC) when ecosystem demands.",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q4",
      "topic": "Plugin naming/directory enforcement",
      "answer": "Option A: Name-directory match (Claude Code pattern)",
      "specialist_consensus": "3/4 CONSENSUS (Architect 9/10 A, Research 8/10 C, Coder 9/10 A, Tester 10/10 A)",
      "binding_constraints": ["D3-Q16 O(1) lookup REQUIRES filename stem matching - constraint-forced"],
      "evidence": "100% of 243+ plugins match name-directory, Documentation explicitly requires it, D3-Q16 binding satisfied",
      "implementation": "~95 LOC validation, $4.1K 3-year TCO, 28 test cases",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q5",
      "topic": "Agent model selection options",
      "answer": "Option B: Fixed set (inherit/sonnet/opus/haiku)",
      "specialist_consensus": "3/4 CONSENSUS (Architect 8/10 C, Research 8/10 B, Coder 9/10 B, Tester 9/10 B)",
      "binding_constraints": ["None - model selection independent of D1-D7"],
      "evidence": "Claude Code native (line 188 of 03-EXTENSION-SYSTEM.md), 56/56 BMAD agents use inherit (0% migration), 60% reuse from claude-mpm, Industry standard pattern",
      "implementation": "~50 LOC, $713 5-year TCO, 41 test cases, 92% coverage",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q6",
      "topic": "Permission modes supported",
      "answer": "Option B: Tiered (default/elevated/bypass)",
      "specialist_consensus": "3/4 CONSENSUS (Architect 9/10 B, Research 9/10 C, Coder 8/10 B, Tester 9/10 B)",
      "binding_constraints": ["D2-Q8 ELIMINATES Option A (requires two-tier Hard/Soft)", "D2-Q12 requires permissionDecisionReason/additionalContext"],
      "evidence": "Claude Code has undocumented acceptEdits (intermediate), D2-Q8 maps to default=HARD/elevated=SOFT/bypass=NONE, 100% BMAD agents use bypass (backward compatible)",
      "implementation": "~220 LOC, $3,900 5-year TCO, 45 test cases, 92% coverage",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q7",
      "topic": "Global vs agent permission interaction",
      "answer": "Option C: Least-privilege wins (more restrictive setting takes precedence)",
      "specialist_consensus": "4/4 UNANIMOUS (Architect 9/10, Research 8/10, Coder 9/10, Tester 7/10)",
      "binding_constraints": ["D2-Q8 HARD/SOFT enforcement aligned", "D8-Q6 tiered model supported"],
      "evidence": "NIST 800-53 AC-6 intersection model, AWS IAM explicit deny pattern, Research found Explore's Option B claim WEAKLY supported - Dynatrace/Sprinklr actually favor local override",
      "implementation": "~100-150 LOC, ~$4K 3-year TCO, ~33 test cases",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q8",
      "topic": "Permission bypass acknowledgment",
      "answer": "Hybrid B+C: Session-start warning + Per-operation audit",
      "specialist_consensus": "3/4 CONSENSUS for B+C (Architect 9/10, Research 9/10, Coder 8/10), Tester 7/10 for B alone",
      "binding_constraints": ["D2-Q12 REQUIRES permissionDecisionReason - Option C provides this", "Option D NOT IMPLEMENTABLE - SessionStart hook cannot block"],
      "evidence": "AWS CloudTrail + Azure Alerts = industry standard for B+C, Claude Code currently implements Option A (silent) with NO acknowledgment",
      "implementation": "~360 LOC (100 warning + 200 audit + 60 shared), ~$8K 3-year TCO, ~32 test cases",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q9",
      "topic": "Plugin identifier format in enabledPlugins",
      "answer": "Option B: Marketplace-qualified (plugin@marketplace)",
      "specialist_consensus": "3/4 CONSENSUS (Architect 10/10, Research 9/10, Coder 10/10), Tester 9/10 A (dissent)",
      "binding_constraints": ["D5-Q9 requires unique identifiers for manifest-based discovery", "Claude Code native format"],
      "evidence": "05-CONFIGURATION.md explicitly defines format, 39/39 plugins use plugin@marketplace, 5 marketplaces validated, $130K+ dependency confusion bounties prevented by qualified names",
      "implementation": "0 LOC (Claude Code native), $0 TCO",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q10",
      "topic": "Agent embedded configuration format",
      "answer": "Option D: Hybrid (YAML frontmatter + XML sections)",
      "specialist_consensus": "4/4 UNANIMOUS (Architect 9/10, Research 8/10, Coder 8/10, Tester 8/10)",
      "binding_constraints": ["D4-Q1/Q3 frontmatter schema patterns satisfied", "Response gate CRITICAL for persona drift prevention"],
      "evidence": "42 BMAD agents use hybrid format, Anthropic docs recommend XML tags in prompts, response_gate 5-step protocol cannot be expressed in frontmatter alone",
      "implementation": "~90 LOC (XML section parser), $4,050 3-year TCO, 60% reuse",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q11",
      "topic": "Response gate enforcement",
      "answer": "Option D: Configurable gates (global template with per-agent opt-in/out)",
      "specialist_consensus": "SPLIT 2/4 D (Architect 8/10, Tester 8/10), 2/4 C (Research 8/10, Coder 9/10) - Resolved to D",
      "binding_constraints": ["D8-Q10 enables XML gate sections", "D2-Q8 two-tier Hard/Soft aligns with configurable gates"],
      "evidence": "gate-function.md ALREADY EXISTS (326 LOC), maps to BMAD 5-step protocol, Coder found 0 LOC for template reuse, D2-Q8 tiered enforcement aligns",
      "implementation": "~150 LOC config system, 100% reuse of gate-function.md as template, ~$8K 3-year TCO",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q12",
      "topic": "Plugin namespacing in subagent_type",
      "answer": "Option B: Optional namespacing (plugin:agent when ambiguous)",
      "specialist_consensus": "4/4 UNANIMOUS (Architect 9/10, Research 9/10, Coder 10/10, Tester 9/10)",
      "binding_constraints": ["D5-Q18 BINDING (shorthand when unambiguous)", "D3-Q16 O(1) filename stem preserved", "D3-Q17 Project>User>System collision resolution"],
      "evidence": "Claude Code NATIVE support (03-EXTENSION-SYSTEM.md:207-209), 0 LOC required, BMAD uses both shorthand and namespaced forms",
      "implementation": "0 LOC (Claude Code native), $0 TCO",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q13",
      "topic": "Agent sidecar knowledge directories",
      "answer": "Option B: Optional sidecar directories (static knowledge only, D5-Q20 compliant)",
      "specialist_consensus": "SPLIT 2/4 D (Architect 8/10, Research 8/10), 2/4 A (Coder 8/10, Tester 8/10) - Resolved to B",
      "binding_constraints": ["D5-Q20 BLOCKS B/C if stateful (single-response, stateless agents)", "D5-Q19 requires explicit Read tool (no auto-load)", "D5-Q17 progressive loading aligned"],
      "evidence": "BMAD defines sidecars (2 ref implementations) but 0 deployed in Claude Code. D5-Q20 constraint requires static-only content. Industry (LangChain, CrewAI, AutoGen) uses NO agent-level sidecars.",
      "implementation": "~80 LOC (discovery, loader), ~$2,500 3-year TCO",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q14",
      "topic": "Triggers array schema",
      "answer": "Option D: Hybrid backward-compatible (both trigger and triggers supported)",
      "specialist_consensus": "4-way split resolved: Architect 7/10 A, Research 8/10 C, Coder 9/10 D (ALREADY IMPLEMENTED), Tester 9/10 B - Resolved to D",
      "binding_constraints": ["D3-Q16 O(1) lookup preserved (triggers don't affect discovery)", "D4-Q1/Q3 valid YAML frontmatter", "D8-Q10 frontmatter for triggers"],
      "evidence": "Coder found Option D ALREADY IMPLEMENTED in bmad-method-source/tools/schema/agent.js (z.union pattern lines 214-351). 0 agents currently use triggers (NEW field). Zero breaking changes.",
      "implementation": "0 LOC (ALREADY IMPLEMENTED), $600 3-year TCO (maintenance)",
      "decided_at": "2025-12-11"
    },
    {
      "question": "Q15",
      "topic": "Hook-based gate mechanism",
      "answer": "Option C+E: Multi-Point Programmable Gates",
      "specialist_consensus": "3/3 unanimous on E (Programmable), 2/3 favor C+E hybrid (Tech Lead 9/10, Research 9/10, Engineer 9/10)",
      "binding_constraints": ["D2-Q15 PreToolUse phase for hard enforcement", "D2-Q16 Hybrid structural+runtime", "D2-Q8 Two-tier hard/soft enforcement", "D2-Q12 permissionDecisionReason schema"],
      "evidence": "Claude Code: Only PreToolUse/UserPromptSubmit can BLOCK, PostToolUse cannot. BMAD: 5-step programmable gate protocol (IDENTIFY->RUN->READ->VERIFY->CLAIM). Industry: 7/7 frameworks use multi-point + programmable (LangGraph, CrewAI, AutoGen, OpenAI, Semantic Kernel, NeMo, Guardrails AI)",
      "implementation": "~150-200 LOC net new, 90% reuse of gate-function.md (326 LOC), ~$4,500 3-year TCO",
      "decided_at": "2025-12-12"
    }
  ],
  "source_documents": [
    "/home/president/bmad-systems/claude-code-architecture/03-EXTENSION-SYSTEM.md",
    "/home/president/bmad-systems/claude-code-architecture/05-CONFIGURATION.md",
    "/home/president/bmad-systems/claude-code-architecture/06-HOOK-SYSTEM.md",
    "/home/president/bmad-systems/personal bmad/BMAD-PERSONAL-ARCHITECTURE.md"
  ],
  "topics": {
    "Q1-Q4": "Plugin manifest format (.claude-plugin/plugin.json)",
    "Q5": "Agent model selection",
    "Q6-Q8": "Permission modes",
    "Q9": "Plugin identification",
    "Q10-Q12": "Agent format specification",
    "Q13": "Agent sidecar knowledge directories",
    "Q14": "Triggers array schema",
    "Q15": "Hook-based gate mechanism"
  },
  "redundancies_removed": {
    "original_count": 22,
    "removed": 8,
    "final_count": 15
  }
}
